<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>문제 제보 페이지</title>
    <!-- Bootstrap CSS -->
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">

    <script>
        // 현재 위치를 가져오는 함수
        function getLocation() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(showPosition, showError);
            } else { 
                document.getElementById("location").innerHTML = "Geolocation is not supported by this browser.";
            }
        }

        // 위치 정보를 가져온 후 지역명을 표시하는 함수
        function showPosition(position) {
            var latitude = position.coords.latitude;
            var longitude = position.coords.longitude;

            // Nominatim API를 사용해 지역명 가져오기
            const url = `https://nominatim.openstreetmap.org/reverse?format=jsonv2&lat=${latitude}&lon=${longitude}`;

            fetch(url)
                .then(response => response.json())
                .then(data => {
                    if (data && data.address) {
                        const address = data.address;
                        // "시", "구", "동" 정보를 추출하여 표시
                        const city = address.city || address.town || address.village || address.state;
                        const county = address.county || address.district || "";
                        const suburb = address.suburb || address.neighbourhood || "";
                        const fullAddress = `${city} ${county} ${suburb}`.trim();
                        document.getElementById("location").innerHTML = `현재 위치: ${fullAddress}`;
                    } else {
                        document.getElementById("location").innerHTML = "위치 정보를 가져올 수 없습니다.";
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    document.getElementById("location").innerHTML = "위치 정보를 가져오는 중 오류가 발생했습니다.";
                });
        }

        // 오류 처리 함수
        function showError(error) {
            switch(error.code) {
                case error.PERMISSION_DENIED:
                    document.getElementById("location").innerHTML = "사용자가 위치 정보 제공을 거부했습니다.";
                    break;
                case error.POSITION_UNAVAILABLE:
                    document.getElementById("location").innerHTML = "위치 정보가 없습니다.";
                    break;
                case error.TIMEOUT:
                    document.getElementById("location").innerHTML = "위치 정보 요청이 시간 초과되었습니다.";
                    break;
                case error.UNKNOWN_ERROR:
                    document.getElementById("location").innerHTML = "알 수 없는 오류가 발생했습니다.";
                    break;
            }
        }
    </script>
</head>
<body onload="getLocation()">

    <div class="container mt-5">
        <h1 class="text-center mb-4">문제 제보 페이지</h1>

        <!-- 현재 위치 표시 영역 -->
        <div class="alert alert-info text-center" role="alert">
            <h4 id="location">위치 정보를 불러오는 중...</h4>
        </div>

        <!-- 문제 유형 선택 폼 -->
        <form id="reportForm" action="/upload" method="POST" enctype="multipart/form-data">
            <div class="form-group">
                <h2>어떤 문제가 있나요?</h2>
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="problem" id="trash" value="쓰레기" required>
                    <label class="form-check-label" for="trash">
                        쓰레기
                    </label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="problem" id="filth" value="오물">
                    <label class="form-check-label" for="filth">
                        오물
                    </label>
                </div>
                <div class="form-check">
                    <input class="form-check-input" type="radio" name="problem" id="damage" value="파손">
                    <label class="form-check-label" for="damage">
                        파손
                    </label>
                </div>
            </div>

            <!-- 이미지 업로드 폼 -->
            <div class="form-group">
                <label for="problemImage">이미지를 업로드 해주세요:</label>
                <input type="file" class="form-control-file" id="problemImage" name="problemImage" accept="image/*">
            </div>

            <!-- 서버로 전송하는 버튼 -->
            <div class="text-center">
                <button type="submit" class="btn btn-primary btn-lg">제보하기</button>
            </div>
        </form>
    </div>

    <!-- Bootstrap JS, Popper.js, and jQuery -->
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.3/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
</body>
</html>
