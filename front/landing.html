<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>처리 상태 확인</title>
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .checkmark {
            font-size: 48px;
            color: #28a745;
        }
        .crossmark {
            font-size: 48px;
            color: #dc3545;
        }
    </style>
</head>
<body>
    <div class="container mt-5 text-center">
        <h1>제보 처리 상태</h1>
        <div id="status-message" class="mt-3">
            <div class="spinner-border text-primary" role="status">
                <span class="sr-only">Loading...</span>
            </div>
            <p class="mt-3">상태를 확인 중입니다...</p>
        </div>
        <div id="back-button" class="mt-4" style="display: none;">
            <a href="/" class="btn btn-secondary">제보 페이지로 돌아가기</a>
        </div>
    </div>

    <script>
        class StatusAnimations {
            get_animation(status) {
                if (status === '처리 중') {
                    return `<div class='spinner-border text-primary' role='status'>
                                <span class='sr-only'>Loading...</span>
                             </div>
                             <p class='mt-3'>상태를 확인 중입니다...</p>`;
                } else if (status === '처리 지연') {
                    return `<div class='text-warning'>
                                <h2>처리 지연 중...</h2>
                                <div class='spinner-border text-warning' role='status'>
                                    <span class='sr-only'>Processing...</span>
                                </div>
                             </div>`;
                } else if (status === '처리 완료') {
                    return `<div class='text-success'>
                                <h2>처리가 완료되었습니다!</h2>
                                <div class='checkmark'>✓</div>
                             </div>`;
                } else if (status.startsWith('쓰레기가 감지되지 않음')) {
                    const [message, score] = status.split(': ');
                    return `<div class='text-info'>
                                <h2>${message}</h2>
                                <div class='crossmark'>✗</div>
                                <p>신뢰도: ${score}%</p>
                             </div>`;
                } else if (status.startsWith('쓰레기가 감지됨')) {
                    const [message, score] = status.split(': ');
                    return `<div class='text-success'>
                                <h2>${message}</h2>
                                <div class='checkmark'>✓</div>
                                <p>신뢰도: ${score}%</p>
                             </div>`;
                }
            }
        }

        const statusAnimation = new StatusAnimations();

        function checkStatus() {
            fetch('/check_status')
                .then(response => response.text())
                .then(status => {
                    const statusMessage = document.getElementById('status-message');
                    statusMessage.innerHTML = statusAnimation.get_animation(status);
                    
                    if (status !== '처리 중') {
                        document.getElementById('back-button').style.display = 'block';
                        clearInterval(intervalId);
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    document.getElementById('status-message').innerHTML = '<h2 class="text-danger">오류가 발생했습니다.</h2>';
                    document.getElementById('back-button').style.display = 'block';
                });
        }

        // 페이지 로드 시 즉시 상태 확인
        checkStatus();

        // 5초마다 상태 확인
        const intervalId = setInterval(checkStatus, 5000);
    </script>
</body>
</html>